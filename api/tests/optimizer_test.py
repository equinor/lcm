import unittest
from typing import List

import matplotlib.pyplot as plt
import numpy as np
from matplotlib.ticker import ScalarFormatter

from calculators.bridge import SIZE_STEPS, theoretical_bridge
from calculators.optimizer import optimize
from config import Config
from util.enums import BridgeOption


def values_within_deviation(array: List, allowed_deviation: float):
    standard_deviation = np.std(array)
    largest_deviation = 0.0
    mean = np.mean(array)
    for fit in array:
        deviation = abs(mean - fit)
        largest_deviation = deviation if deviation > largest_deviation else largest_deviation
        if deviation > standard_deviation + allowed_deviation:
            raise ValueError(f"{fit} deviates too much from the mean {mean}")
    print(f"Standard deviation: {standard_deviation}, Mean: {mean}, Biggest deviation: {largest_deviation}")


product_data = [
    {
        "id": "1b",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Jey",
        "title": "1 B",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.09,
            0.22,
            0.36,
            0.5,
            0.65,
            0.79,
            0.95,
            1.12,
            1.32,
            1.55,
            1.81,
            2.1,
            2.43,
            2.79,
            3.19,
            3.63,
            4.1,
            4.59,
            5.11,
            5.66,
            6.25,
            6.87,
            7.54,
            8.27,
            9.07,
            9.96,
            10.96,
            12.07,
            13.31,
            14.69,
            16.22,
            17.92,
            19.79,
            21.84,
            24.07,
            26.52,
            29.22,
            32.22,
            35.59,
            39.42,
            43.79,
            48.77,
            54.36,
            60.52,
            67.09,
            73.82,
            80.37,
            86.36,
            91.45,
            95.38,
            98.06,
            99.6,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "2b",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Jey",
        "title": "2 B",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.07,
            0.27,
            0.62,
            1.07,
            1.57,
            2.06,
            2.53,
            3.03,
            3.57,
            4.2,
            4.93,
            5.76,
            6.67,
            7.68,
            8.78,
            9.97,
            11.24,
            12.57,
            13.95,
            15.37,
            16.84,
            18.37,
            19.98,
            21.68,
            23.52,
            25.51,
            27.68,
            30.06,
            32.64,
            35.46,
            38.52,
            41.82,
            45.39,
            49.22,
            53.33,
            57.69,
            62.28,
            67.04,
            71.9,
            76.73,
            81.42,
            85.81,
            89.75,
            93.1,
            95.78,
            97.75,
            99.05,
            99.77,
            99.97,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "3b",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Jey",
        "title": "3 B",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.03,
            0.11,
            0.2,
            0.31,
            0.43,
            0.56,
            0.69,
            0.84,
            0.98,
            1.13,
            1.28,
            1.42,
            1.55,
            1.68,
            1.8,
            1.91,
            2.02,
            2.12,
            2.21,
            2.3,
            2.38,
            2.45,
            2.52,
            2.59,
            2.66,
            2.73,
            2.8,
            2.87,
            2.95,
            3.01,
            3.06,
            3.11,
            3.13,
            3.15,
            3.15,
            3.15,
            3.15,
            3.15,
            3.15,
            3.15,
            3.15,
            3.15,
            3.15,
            3.15,
            3.38,
            4.17,
            5.94,
            9.07,
            13.78,
            20.15,
            28.02,
            37.05,
            46.78,
            56.68,
            66.29,
            75.17,
            83.02,
            89.6,
            94.71,
            98.21,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "1C",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Neil",
        "title": "1 C",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.15,
            0.58,
            1.31,
            2.27,
            3.33,
            4.4,
            5.49,
            6.64,
            7.93,
            9.41,
            11.12,
            13.04,
            15.15,
            17.45,
            19.92,
            22.55,
            25.33,
            28.22,
            31.19,
            34.22,
            37.27,
            40.31,
            43.32,
            46.28,
            49.18,
            52.06,
            54.98,
            58.06,
            61.43,
            65.26,
            69.65,
            74.61,
            80.01,
            85.53,
            90.7,
            95.02,
            98.08,
            99.74,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "2c",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Neil",
        "title": "2 C",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.06,
            0.15,
            0.24,
            0.35,
            0.48,
            0.64,
            0.84,
            1.13,
            1.57,
            2.24,
            3.24,
            4.69,
            6.7,
            9.39,
            12.82,
            17.02,
            21.95,
            27.52,
            33.59,
            39.96,
            46.44,
            52.86,
            59.06,
            64.91,
            70.33,
            75.3,
            79.8,
            83.84,
            87.42,
            90.55,
            93.23,
            95.44,
            97.18,
            98.47,
            99.32,
            99.8,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "1f",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Odin",
        "title": "1 F",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.1,
            0.25,
            0.44,
            0.67,
            0.92,
            1.22,
            1.57,
            1.99,
            2.48,
            3.06,
            3.71,
            4.44,
            5.28,
            6.23,
            7.31,
            8.56,
            9.99,
            11.63,
            13.48,
            15.57,
            17.86,
            20.36,
            23.01,
            25.81,
            28.72,
            31.74,
            34.85,
            38.08,
            41.45,
            44.98,
            48.69,
            52.58,
            56.62,
            60.79,
            64.99,
            69.15,
            73.19,
            77.02,
            80.59,
            83.82,
            86.7,
            89.21,
            91.38,
            93.23,
            94.8,
            96.14,
            97.25,
            98.17,
            98.88,
            99.39,
            99.74,
            99.91,
            99.97,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "2f",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Odin",
        "title": "2 F",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.02,
            0.09,
            0.17,
            0.27,
            0.4,
            0.54,
            0.71,
            0.9,
            1.11,
            1.33,
            1.58,
            1.85,
            2.16,
            2.51,
            2.91,
            3.38,
            3.93,
            4.56,
            5.29,
            6.12,
            7.06,
            8.1,
            9.25,
            10.51,
            11.85,
            13.29,
            14.8,
            16.4,
            18.09,
            19.89,
            21.85,
            24.03,
            26.5,
            29.34,
            32.63,
            36.43,
            40.74,
            45.53,
            50.71,
            56.17,
            61.75,
            67.31,
            72.7,
            77.81,
            82.52,
            86.74,
            90.4,
            93.47,
            95.92,
            97.77,
            99.04,
            99.74,
            99.98,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "4f",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Neil",
        "title": "4 F",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.21,
            0.62,
            1.19,
            1.86,
            2.56,
            3.28,
            4.06,
            4.93,
            5.93,
            7.06,
            8.31,
            9.67,
            11.12,
            12.68,
            14.35,
            16.13,
            18.05,
            20.09,
            22.27,
            24.58,
            27.0,
            29.52,
            32.12,
            34.77,
            37.48,
            40.3,
            43.32,
            46.7,
            50.63,
            55.29,
            60.82,
            67.19,
            74.18,
            81.33,
            88.03,
            93.6,
            97.53,
            99.66,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "5 f",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Ferdinan",
        "title": "6 F",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.08,
            0.2,
            0.35,
            0.52,
            0.71,
            0.91,
            1.13,
            1.39,
            1.68,
            2.01,
            2.38,
            2.8,
            3.27,
            3.81,
            4.44,
            5.19,
            6.06,
            7.1,
            8.32,
            9.75,
            11.38,
            13.23,
            15.31,
            17.61,
            20.14,
            22.93,
            25.99,
            29.38,
            33.12,
            37.24,
            41.74,
            46.62,
            51.79,
            57.17,
            62.62,
            68.01,
            73.2,
            78.09,
            82.57,
            86.57,
            90.04,
            92.95,
            95.29,
            97.08,
            98.38,
            99.25,
            99.75,
            99.97,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "1g",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Dixi",
        "title": "1 G",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.02,
            0.09,
            0.17,
            0.25,
            0.33,
            0.41,
            0.5,
            0.59,
            0.69,
            0.81,
            0.94,
            1.09,
            1.24,
            1.38,
            1.52,
            1.64,
            1.76,
            1.9,
            2.12,
            2.5,
            3.13,
            4.11,
            5.54,
            7.47,
            9.95,
            12.94,
            16.39,
            20.21,
            24.34,
            28.73,
            33.38,
            38.34,
            43.67,
            49.41,
            55.58,
            62.08,
            68.75,
            75.35,
            81.59,
            87.15,
            91.8,
            95.38,
            97.88,
            99.42,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "2g",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Dixi",
        "title": "2 G",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.08,
            0.19,
            0.36,
            0.59,
            0.9,
            1.33,
            1.89,
            2.61,
            3.54,
            4.7,
            6.15,
            7.95,
            10.17,
            12.88,
            16.15,
            20.07,
            24.69,
            30.02,
            36.05,
            42.68,
            49.75,
            57.05,
            64.29,
            71.2,
            77.5,
            82.97,
            87.49,
            91.03,
            93.65,
            95.48,
            96.71,
            97.51,
            98.07,
            98.51,
            98.89,
            99.23,
            99.52,
            99.73,
            99.86,
            99.91,
            99.94,
            99.96,
            99.98,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "3g",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Dixi",
        "title": "3 Ge",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.02,
            0.07,
            0.15,
            0.25,
            0.39,
            0.57,
            0.81,
            1.14,
            1.56,
            2.1,
            2.78,
            3.62,
            4.66,
            5.93,
            7.45,
            9.24,
            11.32,
            13.7,
            16.36,
            19.26,
            22.35,
            25.54,
            28.75,
            31.9,
            34.91,
            37.76,
            40.43,
            42.98,
            45.5,
            48.1,
            50.9,
            54.01,
            57.48,
            61.3,
            65.43,
            69.77,
            74.19,
            78.58,
            82.81,
            86.75,
            90.32,
            93.42,
            95.99,
            97.97,
            99.32,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "1l ",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Neil",
        "title": "1 L",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.07,
            0.18,
            0.31,
            0.47,
            0.66,
            0.88,
            1.13,
            1.41,
            1.73,
            2.07,
            2.45,
            2.85,
            3.26,
            3.67,
            4.08,
            4.46,
            4.81,
            5.16,
            5.52,
            5.94,
            6.49,
            7.24,
            8.25,
            9.57,
            11.23,
            13.22,
            15.49,
            17.99,
            20.69,
            23.58,
            26.72,
            30.22,
            34.21,
            38.84,
            44.18,
            50.23,
            56.88,
            63.91,
            71.03,
            77.89,
            84.12,
            89.45,
            93.67,
            96.73,
            98.71,
            99.74,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "1m",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Neil",
        "title": "1 M",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.05,
            0.1,
            0.16,
            0.23,
            0.3,
            0.37,
            0.44,
            0.51,
            0.59,
            0.67,
            0.76,
            0.85,
            0.94,
            1.04,
            1.13,
            1.22,
            1.3,
            1.37,
            1.45,
            1.53,
            1.65,
            1.83,
            2.08,
            2.41,
            2.81,
            3.25,
            3.68,
            4.03,
            4.28,
            4.4,
            4.4,
            4.4,
            4.4,
            4.43,
            4.75,
            6.14,
            9.86,
            17.23,
            28.89,
            44.25,
            61.24,
            77.06,
            89.32,
            96.95,
            99.98,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "3 m",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Neil",
        "title": "3 M",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.06,
            0.14,
            0.21,
            0.29,
            0.38,
            0.47,
            0.57,
            0.67,
            0.77,
            0.87,
            0.96,
            1.05,
            1.14,
            1.23,
            1.32,
            1.43,
            1.55,
            1.7,
            1.86,
            2.04,
            2.2,
            2.34,
            2.44,
            2.44,
            2.44,
            2.44,
            2.44,
            2.44,
            2.44,
            2.44,
            2.44,
            2.44,
            2.44,
            2.44,
            2.44,
            2.44,
            2.44,
            2.6,
            3.48,
            5.84,
            10.28,
            17.06,
            26.04,
            36.75,
            48.48,
            60.41,
            71.73,
            81.66,
            89.63,
            95.34,
            98.8,
            99.99,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "3m",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Neil",
        "title": "3 M",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.05,
            0.22000000000000003,
            0.51,
            0.89,
            1.31,
            1.75,
            2.19,
            2.65,
            3.1399999999999997,
            3.67,
            4.25,
            4.87,
            5.55,
            6.279999999999999,
            7.079999999999999,
            7.9399999999999995,
            8.85,
            9.809999999999999,
            10.819999999999999,
            11.87,
            12.959999999999999,
            14.1,
            15.299999999999999,
            16.57,
            17.92,
            19.360000000000003,
            20.910000000000004,
            22.570000000000004,
            24.340000000000003,
            26.220000000000002,
            28.19,
            30.25,
            32.39,
            34.62,
            36.959999999999994,
            39.449999999999996,
            42.129999999999995,
            45.03999999999999,
            48.19999999999999,
            51.62999999999999,
            55.319999999999986,
            59.219999999999985,
            63.27999999999999,
            67.42999999999999,
            71.58999999999999,
            75.69999999999999,
            79.68999999999998,
            83.48999999999998,
            87.02999999999999,
            90.21,
            92.96,
            95.22,
            96.97,
            98.23,
            99.05,
            99.52,
            99.75999999999999,
            99.88999999999999,
            99.94999999999999,
            99.96999999999998,
            99.96999999999998,
            99.96999999999998,
            99.96999999999998,
            99.96999999999998,
            99.96999999999998,
            99.96999999999998,
            99.96999999999998,
            99.96999999999998,
            99.96999999999998,
        ],
        "sackSize": 25,
    },
    {
        "id": "1o",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Dixi",
        "title": "1 O",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.07,
            0.16,
            0.27,
            0.42,
            0.61,
            0.86,
            1.19,
            1.62,
            2.17,
            2.84,
            3.65,
            4.61,
            5.72,
            7.01,
            8.49,
            10.22,
            12.25,
            14.66,
            17.51,
            20.89,
            24.81,
            29.25,
            34.14,
            39.33,
            44.63,
            49.83,
            54.75,
            59.22,
            63.19,
            66.65,
            69.68,
            72.39,
            74.94,
            77.5,
            80.17,
            83.0,
            85.94,
            88.89,
            91.7,
            94.22,
            96.33,
            97.97,
            99.13,
            99.8,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "2o",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Dixi",
        "title": "2 O",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.08,
            0.27,
            0.58,
            0.96,
            1.39,
            1.8,
            2.22,
            2.64,
            3.11,
            3.63,
            4.21,
            4.85,
            5.52,
            6.24,
            7.0,
            7.79,
            8.62,
            9.48,
            10.37,
            11.28,
            12.21,
            13.18,
            14.18,
            15.25,
            16.38,
            17.6,
            18.91,
            20.32,
            21.85,
            23.49,
            25.25,
            27.13,
            29.14,
            31.29,
            33.57,
            35.97,
            38.5,
            41.14,
            43.85,
            46.61,
            49.39,
            52.14,
            54.82,
            57.41,
            59.87,
            62.23,
            64.51,
            66.76,
            69.04,
            71.44,
            74.03,
            76.84,
            79.9,
            83.16,
            86.53,
            89.84,
            92.89,
            95.51,
            97.55,
            98.98,
            99.79,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "1s",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Dixi",
        "title": "1 S",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.02,
            0.07,
            0.11,
            0.16,
            0.2,
            0.26,
            0.34,
            0.43,
            0.55,
            0.69,
            0.87,
            1.08,
            1.32,
            1.61,
            1.94,
            2.3,
            2.69,
            3.1,
            3.53,
            3.97,
            4.41,
            4.86,
            5.31,
            5.75,
            6.17,
            6.58,
            6.95,
            7.31,
            7.63,
            7.94,
            8.25,
            8.57,
            8.92,
            9.31,
            9.75,
            10.23,
            10.73,
            11.25,
            11.74,
            12.21,
            12.64,
            13.05,
            13.45,
            13.86,
            14.28,
            14.69,
            15.08,
            15.4,
            15.66,
            15.92,
            16.3,
            17.03,
            18.43,
            20.83,
            24.53,
            29.72,
            36.42,
            44.44,
            53.4,
            62.79,
            72.03,
            80.59,
            87.98,
            93.85,
            97.91,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "2s",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Dixi",
        "title": "2S",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.05,
            0.38,
            1.1,
            2.17,
            3.44,
            4.71,
            5.89,
            6.95,
            7.97,
            9.09,
            10.43,
            12.09,
            14.15,
            16.66,
            19.68,
            23.22,
            27.25,
            31.69,
            36.42,
            41.34,
            46.31,
            51.25,
            56.11,
            60.9,
            65.62,
            70.3,
            74.93,
            79.49,
            83.87,
            87.95,
            91.58,
            94.62,
            96.96,
            98.59,
            99.55,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "3s",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Dixi",
        "title": "3S",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.08,
            0.19,
            0.31,
            0.45,
            0.61,
            0.78,
            0.97,
            1.18,
            1.39,
            1.63,
            1.87,
            2.14,
            2.42,
            2.71,
            3.03,
            3.36,
            3.73,
            4.13,
            4.59,
            5.09,
            5.66,
            6.3,
            7.0,
            7.77,
            8.58,
            9.45,
            10.38,
            11.42,
            12.65,
            14.21,
            16.26,
            19.04,
            22.75,
            27.58,
            33.65,
            40.93,
            49.24,
            58.21,
            67.35,
            76.07,
            83.81,
            90.16,
            94.87,
            97.96,
            99.67,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "4s",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Dixi",
        "title": "4S",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.07,
            0.29,
            0.65,
            1.13,
            1.65,
            2.17,
            2.69,
            3.23,
            3.85,
            4.57,
            5.41,
            6.37,
            7.44,
            8.62,
            9.9,
            11.26,
            12.7,
            14.2,
            15.74,
            17.31,
            18.93,
            20.59,
            22.33,
            24.16,
            26.1,
            28.17,
            30.4,
            32.79,
            35.35,
            38.09,
            41.05,
            44.23,
            47.67,
            51.39,
            55.39,
            59.66,
            64.14,
            68.75,
            73.35,
            77.8,
            81.97,
            85.73,
            88.99,
            91.72,
            93.93,
            95.68,
            97.05,
            98.09,
            98.87,
            99.41,
            99.75,
            99.93,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "5s",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Dixi",
        "title": "5S",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.07,
            0.15,
            0.24,
            0.34,
            0.45,
            0.56,
            0.68,
            0.81,
            0.95,
            1.08,
            1.22,
            1.36,
            1.5,
            1.64,
            1.78,
            1.91,
            2.03,
            2.15,
            2.27,
            2.38,
            2.5,
            2.62,
            2.77,
            2.92,
            3.09,
            3.27,
            3.43,
            3.56,
            3.64,
            3.66,
            3.66,
            3.66,
            3.66,
            3.78,
            4.34,
            5.8,
            8.68,
            13.37,
            20.07,
            28.7,
            38.84,
            49.85,
            60.95,
            71.38,
            80.48,
            87.83,
            93.3,
            96.96,
            99.12,
            99.9,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
    {
        "id": "6s",
        "co2": 1000,
        "cost": 100,
        "environmental": "Green",
        "sack_size": 25,
        "supplier": "Neil",
        "title": "6 S",
        "cumulative": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.07,
            0.17,
            0.29,
            0.45,
            0.63,
            0.85,
            1.1,
            1.38,
            1.69,
            2.02,
            2.36,
            2.72,
            3.1,
            3.5,
            3.93,
            4.38,
            4.87,
            5.39,
            5.95,
            6.53,
            7.13,
            7.76,
            8.43,
            9.17,
            10.0,
            10.97,
            12.13,
            13.5,
            15.1,
            16.87,
            18.75,
            20.64,
            22.45,
            24.13,
            25.75,
            27.5,
            29.71,
            32.77,
            37.06,
            42.82,
            50.01,
            58.29,
            67.04,
            75.5,
            82.96,
            88.92,
            93.22,
            96.04,
            97.72,
            98.69,
            99.28,
            99.67,
            99.91,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
            100.0,
        ],
        "sackSize": 25,
    },
]


class OptimizerTest(unittest.TestCase):
    @staticmethod
    def _short_test_wrapper(theoretical_bridge):
        mass = 3500
        max_iterations = 500
        result_list = []
        for i in range(20):
            result = optimize(product_data, theoretical_bridge, mass, max_iterations)
            result_list.append(result)
        fitness = [run["score"] for run in result_list]
        values_within_deviation(fitness, 3)

    def test_deviation_short_permeability(self):
        bridge = theoretical_bridge(BridgeOption.PERMEABILITY, 500)
        self._short_test_wrapper(bridge)

    def test_deviation_short_max_poresize(self):
        bridge = theoretical_bridge(BridgeOption.MAXIMUM_PORESIZE, 500)
        self._short_test_wrapper(bridge)

    def test_deviation_short_avg_poresize(self):
        bridge = theoretical_bridge(BridgeOption.AVERAGE_PORESIZE, 500)
        self._short_test_wrapper(bridge)


def create_algorithm_report():
    runs = 100
    mass = 3500
    max_iterations = 500
    bridge = theoretical_bridge(BridgeOption.PERMEABILITY, 500)

    # Crate Matplotlib figure
    # fig, (bridgeplot, alg_curve, mix_plot) = plt.subplots(3)
    fig, (bridgeplot, alg_curve, massplot) = plt.subplots(3)
    fig.set_size_inches(9.4, 9.4)

    # Draw optimal bridge
    bridgeplot.set_title("Bridges")
    bridgeplot.set_xscale("log")
    bridgeplot.set_xlabel("Particle Size m")
    bridgeplot.set_ylabel("Accumulated volume %")
    bridgeplot.set_xticks([0.1, 1, 10, 100, 1000])
    bridgeplot.xaxis.set_major_formatter(ScalarFormatter())
    bridgeplot.plot(SIZE_STEPS, bridge, color="black", label="ideal")
    bridgeplot.axes.set_ylim([0, 100])
    bridgeplot.axes.set_xlim([0.01, 10000])

    alg_curve.set_title(f"Fitness Evolution ({50} runs)")
    alg_curve.set_xlabel("Generations")
    alg_curve.set_ylabel("Fitness")

    massplot.set_title(f"Mass evolution")
    massplot.set_xlabel("Generations")
    massplot.set_ylabel("Kg")

    for i in range(runs):
        result = optimize(product_data, bridge, mass, max_iterations)
        label = f"{i}-{round(result['score'], 1)}"
        bridgeplot.plot(SIZE_STEPS, result["cumulative_bridge"], label=label)
        alg_curve.plot(result["curve"], label=label)
        massplot.plot(result["mass_progress"])
        # for prod in result["combination_progress"]:
        #     mix_plot.plot(prod)
        print(f"{i} of {runs} runs complete...")

    print("Done!")
    print(f"Saving plot to {Config.HOME_DIR}/algo_test_report.png")
    # Display plots
    # bridgeplot.legend(loc="right", bbox_to_anchor=(1.13, 0.5))
    # alg_curve.legend(loc="right", bbox_to_anchor=(1.13, 2))
    # plt.subplots_adjust(right=0.9)
    plt.tight_layout()
    fig.savefig(f"{Config.HOME_DIR}/algo_test_report.png", format="png")


if __name__ == "__main__":
    create_algorithm_report()
